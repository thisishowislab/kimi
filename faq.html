<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>the manifestorium | faq</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Space+Grotesk:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        body { background: #050505; color: #e0e0e0; font-family: 'Space Grotesk', sans-serif; }
        .serif { font-family: 'Cinzel', serif; }
        .glass { background: rgba(255,255,255,0.03); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); }
        .answer { max-height: 0; overflow: hidden; transition: max-height 0.3s ease-out; }
        .answer.open { max-height: 500px; }
    </style>
</head>
<body class="min-h-screen pb-24">
    <nav class="fixed top-0 w-full z-50 glass border-b border-white/10">
        <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
            <a href="/home.html" class="serif text-xl tracking-widest text-white">THE MANIFESTORIUM</a>
            <div class="hidden md:flex gap-8 text-sm tracking-widest uppercase">
                <a href="/community.html" class="hover:text-cyan-400">Community</a>
                <a href="/faq.html" class="text-cyan-400">FAQ</a>
                <a href="/contact.html" class="hover:text-cyan-400">Contact</a>
            </div>
        </div>
    </nav>

    <main class="pt-32 pb-24 px-6 max-w-3xl mx-auto">
        <div class="flex items-center justify-between gap-4 mb-4">
            <h1 class="serif text-5xl text-center flex-1">Questions</h1>
            <button id="random-switch" class="glass px-4 py-2 text-xs uppercase tracking-widest hover:text-cyan-400 transition">Random Switch</button>
        </div>
        <p class="text-center text-gray-500 mb-16">Some answers. Not all of them useful.</p>

        <div class="space-y-4" id="faq-container"></div>
    </main>

    <script>
        const fallbackFaqs = [
            {
                q: "Is the bus actually bigger on the inside?",
                a: "Technically no, but perceptually yes. Portal 2 creates a recursive spatial loop that adds approximately 400 square feet of perceived volume. Bring a compass. It won't help, but bring one anyway."
            },
            {
                q: "What do Mini Slabbers eat?",
                a: "Attention, mostly. But also dried apricots and small screws. Do not feed them after midnight. We don't know what happens, and we don't want to find out."
            },
            {
                q: "Can I drive the bus?",
                a: "No. The bus drives itself when it wants to move. We haven't figured out how to stop it from relocating to the Salton Sea every third Tuesday. We just move our workshops."
            },
            {
                q: "Are the portals dangerous?",
                a: "Only if you're not paying attention. Portal 5 temporarily inverted a visitor's gravity last month. He's fine now, but he has to wear weighted boots on Tuesdays."
            },
            {
                q: "Do you have WiFi?",
                a: "We have Portal 6. It's faster than WiFi but requires you to think in binary. Your phone won't work here anyway. The Navy's radar interferes with everything except carrier pigeons."
            },
            {
                q: "What's the deal with the bathroom?",
                a: "It's a composting toilet that opens to a pocket dimension. We don't know where it goes. Please don't put anything in it that you want to see again, including regrets."
            },
            {
                q: "Can I live in the bus?",
                a: "You can try. Three people have. Two left voluntarily. One became a Mini Slabber. We don't talk about him, but he seems happy."
            },
            {
                q: "Is this legal?",
                a: "Define legal. Define reality. Define 'is.' We pay taxes to the Salton Sea Authority, which may or may not exist."
            }
        ];

        let faqs = [...fallbackFaqs];

        function normalizeFaqs(value) {
            const source = Array.isArray(value?.faqs) ? value.faqs : value;
            if (!Array.isArray(source)) return [];
            return source
                .map((item) => ({ q: item?.q || item?.question || '', a: item?.a || item?.answer || '' }))
                .filter((item) => item.q && item.a);
        }

        function shuffleFaqs() {
            faqs = [...faqs].sort(() => Math.random() - 0.5);
            renderFaqs();
        }

        function renderFaqs() {
            const container = document.getElementById('faq-container');
            container.innerHTML = faqs.map((faq, idx) => `
                <div class="glass rounded-lg cursor-pointer" data-faq-index="${idx}">
                    <div class="p-6 flex justify-between items-center">
                        <h3 class="text-lg text-white pr-8">${faq.q}</h3>
                        <span class="text-cyan-400 text-2xl transition-transform duration-300" id="icon-${idx}">+</span>
                    </div>
                    <div class="answer px-6 pb-6 text-gray-400 leading-relaxed" id="answer-${idx}">
                        ${faq.a}
                    </div>
                </div>
            `).join('');
        }

        function toggleFaq(idx) {
            const answer = document.getElementById(`answer-${idx}`);
            const icon = document.getElementById(`icon-${idx}`);
            if (!answer || !icon) return;

            const open = answer.classList.contains('open');

            document.querySelectorAll('.answer').forEach((el) => el.classList.remove('open'));
            document.querySelectorAll('[id^="icon-"]').forEach((el) => {
                el.style.transform = 'rotate(0deg)';
            });

            if (!open) {
                answer.classList.add('open');
                icon.style.transform = 'rotate(45deg)';
            }
        }

        async function loadFaqs() {
            try {
                const response = await fetch('/data/faq.json', { cache: 'no-store' });
                if (response.ok) {
                    const payload = await response.json();
                    const loadedFaqs = normalizeFaqs(payload);
                    if (loadedFaqs.length) {
                        faqs = loadedFaqs;
                    }
                }
            } catch (error) {
                console.error('Falling back to built-in FAQ content:', error);
            }

            renderFaqs();
        }

        document.getElementById('faq-container').addEventListener('click', (event) => {
            const card = event.target.closest('[data-faq-index]');
            if (!card) return;
            toggleFaq(Number(card.dataset.faqIndex));
        });

        document.getElementById('random-switch').addEventListener('click', shuffleFaqs);
        loadFaqs();
    </script>
</body>
</html>
